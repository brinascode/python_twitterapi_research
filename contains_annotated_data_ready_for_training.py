import spacy
import random


TRAIN_DATA = [('ARE YOU PLAYING Minecraft WITH OTHER STAFF YES OR NO?', {'entities': [(16, 26, 'Entertainment')]}), ('RT @RachelRGonzalez: Marianne Williamson—she brought this pie crust and told everyone to empty their negative energy into it and let it go.…', {'entities': [(58, 61, 'Food'), (62, 67, 'Food')]}), ('RT @fiImquaker: yes the rumors r true i got tickets to see harry w the loml', {'entities': [(44, 51, 'Entertainment'), (71, 75, 'Love')]}), ('RT @toocoldlos: The homie got too faded and started sing opera https://t.co/oe0W8I2j7m', {'entities': [(57, 62, 'Entertainment')]}), ("RT @kirtletirtle: Hey yall! I'm making a cookbook with some peers for a group of migrant women in Argentina. I need help raising the funds…", {'entities': [(133, 138, 'Money'), (41, 49, 'Food')]}), ("RT @mrmikeyreid: oh word? tell lil mans if he wants to pull up i'll be waiting outside the asphalt cafe with the strap https://t.co/nEE4jSA…", {'entities': [(99, 103, 'Food')]}), ('RT @Catholic_Guilt_: I left the groceries for ONE MINUTE so I could pee and he took a bite out of every single tortilla. I hate him I hate…', {'entities': [(32, 41, 'Food'), (111, 119, 'Food'), (86, 90, 'Food')]}), ('RT @Qthunchoo: If we’re dating, I want to be your second priority. I want your first priority to be you, your life, your future, your ambit…', {'entities': [(24, 30, 'Love')]}), ('RT @andrew_durso: stand-up is an industry built around pretending they make you say the italian words at starbucks. every time i’ve asked f…', {'entities': [(105, 114, 'Food')]}), ('Milk dedicated his life to advocate for a better and m…', {'entities': [(27, 35, 'Justice')]}), ('The chaotic energy that stresses me the most is ‘entitled dad making multiple chipotle orders at once’', {'entities': [(78, 86, 'Food')]}), ("RT @aggichristiane: The Tractor Demo has arrived outside the Brandenburger Tor - they've driven from various parts of Germany to protest Be…", {'entities': [(129, 136, 'Justice')]}), ('There’s a difference between 1.) genuinely seeking out the perspective of marginalized individuals to center them i… https://t.co/grKugye9Fs', {'entities': [(74, 86, 'Justice')]}), ('I really spent 20 minutes at a party teaching a couple about STI transmission and prevention ', {'entities': [(31, 36, 'Entertainment')]}), ('RT @renireni: Vegetables from the brassica family (broccoli, kale, cabbage, brussel sprouts, cauliflower etc) are delicious. They have a po…', {'entities': [(14, 24, 'Food'), (51, 59, 'Food'), (61, 65, 'Food'), (67, 74, 'Food'), (76, 91, 'Food'), (93, 104, 'Food')]}), ('RT @CarolLeonnig: NEW Justice Kennedy privately and successfully lobbied @realDonaldTrump to get his clerk - Brett Kavanaugh -  added to co…', {'entities': [(65, 72, 'Justice')]}), ('Sign on! Share! Tell everyone you know! The time for decreasing barriers to sexual health is NOW. https://t.co/OSbd8SksL3', {'entities': [(9, 15, 'Help'), (0, 8, 'Help')]}), ('RT @hoos4sexed: Sign on to our letter advocating for free STI testing at Student Health. The time is now. ', {'entities': [(16, 23, 'Help')]}), ('sophomore and junior girls in high school! apply to the #HerLead Fellowship by March 8th, 2019! let it change your… https://t.co/Dp6zw1NMtm', {'entities': [(43, 48, 'Help')]}), ('What clothing stores got the best sales???', {'entities': [(5, 13, 'Clothing'), (14, 20, 'shopping'), (34, 39, 'shopping')]}), ('He didn’t want her til she was already in love with another man smh niggas https://t.co/aScRuVWMAG', {'entities': [(42, 46, 'Love')]}), ('Let me stop playing and go ahead and finish this sleeve', {'entities': [(12, 19, 'Entertainment')]}), ('Pause...so you’re telling me that Big Sean was invited to Jhené’s daughters birthday party. Where is TWENTY88 Pt.2', {'entities': [(85, 90, 'Entertainment')]}), ('@ecstakeem ohhhh you’re bout to have a break break', {'entities': [(39, 44, 'Entertainment')]}), ('RT @KEIRYYONCE: Beyoncé performing “Halo” for the first time(February 12, 2009) vs the last time she performed it(December 2, 2018)  https…', {'entities': [(16, 23, 'Entertainment'), (101, 110, 'Entertainment')]}), ('RT @sadzaprincess: Why is davido shouting at us like this?? https://t.co/5QDLoFvTXp', {'entities': [(26, 32, 'Entertainment')]}), ('all these singles for wot', {'entities': [(10, 17, 'Love')]}), ('i got a haircut yesterday and james hyped me up about this selfie so here, have cute me and not potato post surgery… https://t.co/wVIAGEAE4s', {'entities': [(8, 15, 'shopping'), (96, 102, 'Food')]}), ('the donation Jeff bezos made to charity https://t.co/o2gNAu6Qnm', {'entities': [(4, 12, 'Money'), (32, 39, 'Justice')]}), ('RT @jackilynd_d: “We can disagree and still love each other unless your disagreement is rooted in my oppression and denial of my humanity a…', {'entities': [(129, 137, 'Justice'), (101, 111, 'Justice')]}), ('Criminal Justice majors be like damn I gotta solve Jeffrey Epstein’s murder by Friday', {'entities': [(9, 16, 'Justice'), (0, 8, 'Justice'), (69, 75, 'Justice')]}), ('RT @fhsusga: professors when students begin packing up to leave before class is over https://t.co/r47bXmxsl0', {'entities': [(13, 23, 'Work'), (71, 76, 'Work')]}), ('RT @TigerMediaNet: During its first Town Hall, @fhsusga hoped to give answers to students on how to improve campus. ', {'entities': [(108, 114, 'Work')]}), ('RT @fhsusga: Town Hall tonight at 5 pm in the Cody Commons! Free speech, free pizza, and a free opportunity to make FHSU a better place. ht…', {'entities': [(60, 64, 'Money'), (78, 83, 'Food')]}), ('The delorean is so much cooler then the tesla cybertruck...that is ugliest thing that I have EVER seen', {'entities': [(46, 56, 'Product')]}), ('Okay, whoever invented chilli cheese fries I freaking love you!', {'entities': [(37, 42, 'Food'), (30, 36, 'Food'), (23, 29, 'Food')]}), ('It’s 12:30 and I have yet to get up out of bed 1.) I have to pee 2.) I’m hungry af.. it’s not that I’m lazy it’s ju… https://t.co/nopBQXBD8A', {'entities': [(73, 79, 'Food')]}), ('Tacos part 2.  I’m about to drive home for some Taco Johns because Taco Bell is SHIT...y’all pick ur fav', {'entities': [(0, 4, 'Food')]}), ('I got a snap earlier this evening about tacos....just saying I’ve been thinking about them tacos all night  P.S. I… https://t.co/1snwwIBMd3', {'entities': [(40, 45, 'Food')]}), ('Idk how I survived high school going to class for 8 hrs a day, going to practice then going to work all in one day… https://t.co/ev67whSvun', {'entities': [(72, 80, 'Work')]}), ('RT @FHSUCheer: Come support your FHSU Tiger Cheer Squad and get in on some fun exercise!! All ages welcome! Click on the link in our bio to…', {'entities': [(20, 27, 'Help'), (108, 113, 'Help')]}), ('I just want to be able to wear sweatpants and a hoodie outside without dying in the heat. Is that too much to ask?', {'entities': [(31, 41, 'Clothing'), (48, 54, 'Clothing')]}), ('RT @big_hungry1: need 150 retweets for no floor meeting. its 7:52 and we got till 9. https://t.co/Bw6FRahVsf', {'entities': [(26, 34, 'Help')]}), ('ICE created a fake university, then: ', {'entities': [(19, 29, 'Work'), (0, 3, 'Justice')]}), ('@helloaxta the font is bigger so it helps u meet a page requirement for an essay u don’t wanna write', {'entities': [(75, 80, 'Work')]}), ('gamer', {'entities': [(0, 5, 'Entertainment')]}), ('soci majors be like damn i don’t have anything due because days of the week are social constructs', {'entities': [(87, 97, 'Justice')]}), ("RT @jaspscherer:  Today is Election Day in Houston! Here's what you need to know about countywide voting, where to find polling locations…", {'entities': [(31, 39, 'Justice'), (102, 108, 'Justice')]}), ('RT @shortyvoorde: came for the politics, stayed for the niche Catholic jokes https://t.co/Qc6ICo3EcM', {'entities': [(31, 39, 'Justice')]}), ('abuse', {'entities': [(0, 5, 'Justice')]}), ('My roommate just said, “I’m only involved in rocket club and cheese club. I just shoot things in the air and eat dairy.”', {'entities': [(61, 67, 'Food'), (109, 112, 'Food'), (113, 118, 'Food')]}), ('unconstitutional', {'entities': [(0, 16, 'Justice')]}), ('@GraceWeber205 Family: “You got a boyfriend yet?”', {'entities': [(34, 43, 'Love')]}), ('job', {'entities': [(0, 3, 'Work')]}), ('Me: *scrutinizes roommate’s baking techniques*', {'entities': [(28, 34, 'Food')]}), ('Roommate: “I’m a STEM major okay, I know how to make an apple pie.” https://t.co/Nb91JvG3Yx', {'entities': [(17, 21, 'Work'), (56, 61, 'Food'), (62, 65, 'Food')]}), ('Just tried oat milk for the first time, thinkin abt making it my entire personality', {'entities': [(15, 19, 'Food'), (11, 14, 'Food')]}), ('@kkeeltygartland Sir, I JUST SAID I don’t want to dismiss progressives. We need a mock caucus w/ a presence from pr… https://t.co/nqi0jEt4R5', {'entities': [(58, 70, 'Justice'), (87, 93, 'Justice')]}), ('I will call out ANYONE who is rude and exclusionary towards an org that represents a candidate. I can’t stand centr… https://t.co/um7dWDlnAq', {'entities': [(85, 94, 'Justice')]}), ('@DavidHuffForAZ Yesssss! A presidential campaign would be incomplete without support from an extremely popular pres… https://t.co/12ippSkozG', {'entities': [(40, 48, 'Justice')]}), ('Pineapple on pizza is not gross. https://t.co/nuwkiEX56f', {'entities': [(0, 9, 'Food'), (13, 18, 'Food')]}), ("Love going to a school that condemns silent protesters that don't agree with the illegal occupation of Gaza, but sa… https://t.co/LhyrubIgR7", {'entities': [(44, 54, 'Justice'), (81, 88, 'Justice'), (103, 107, 'Justice')]}), ('RT @ZachariahChou: Here is my take on the justifications behind the impeachment of the UF Student Body President over bringing Donald Trump…', {'entities': [(103, 112, 'Justice'), (134, 139, 'Justice')]}), ('End the racist war on drugs', {'entities': [(29, 38, 'Justice'), (8, 14, 'Justice')]}), ('RT @GatorsForBernie: This debate is so unfair to Joe Biden, why couldn’t they host it before his 8:30 bedtime? #demdebate', {'entities': [(49, 58, 'Justice')]}), ('RT @CollegeDems: I’m gonna tell my kids that these were the courageous Congressional Republicans who held Trump accountable. https://t.co/6…', {'entities': [(71, 84, 'Justice'), (85, 96, 'Justice')]}), ('Joe Biden really just said he was going to keep punching at violence against women until it goes away #DemDebate', {'entities': [(60, 68, 'Justice')]}), ('DACA has given a generation of immigrants a chance to build a future in the country they call home. The program gra… https://t.co/NCmgQZjWRq', {'entities': [(31, 41, 'Justice')]}), ('It’s Election Day! Make sure to go out and vote, then contact everyone you know and remind them to vote! Voter turn… https://t.co/O5vpRZSFlz', {'entities': [(43, 47, 'Justice')]}), ('It’s been such an honor to serve on the @CTKidGovernor Advisory Committee. The program empowers 5th graders to lear… https://t.co/GQxC6pjPVa', {'entities': [(95, 101, 'Justice'), (64, 73, 'Justice')]}), ('RT @RonfromAK: @CollegeDems has incredible potential but so many of our goals are blocked by the DNC due to a lack of funding. Our members…', {'entities': [(118, 125, 'Money'), (97, 100, 'Justice')]}), ('on today’s episode of: what meaningful thing will i encounter in college today  https://t.co/WHoA4EmGYY', {'entities': [(65, 72, 'Work')]}), ('RT @ArianaGrande: u a fuckin piano or what https://t.co/TaHUyJE9cE', {'entities': [(29, 34, 'Product')]}), ('RT @Harry_Styles: FINE LINE . THE album . DEC 13 https://t.co/pXUVpdtd5L', {'entities': [(34, 39, 'Entertainment')]}), ('RT @ABCNetwork: The top three contestants in Jeopardy! history will face off in an epic primetime special event: “Jeopardy! The Greatest of…', {'entities': [(45, 53, 'Entertainment'), (88, 97, 'Entertainment'), (106, 111, 'Entertainment')]}), ('RT @ajiswriting: If I’m following or interacting with your abuser, lmk and I will cut them tf out of my life and I mean that. There have be…', {'entities': [(59, 65, 'Justice')]}), ('meal', {'entities': [(0, 4, 'Food')]}), ('RT @UhhhHeaven: A haunted car wash?? This is the creativity we need on the table!!!! https://t.co/MdoSNjLtvP', {'entities': [(26, 29, 'Product')]}), ('RT @2high2careeeeee: STOP blocking your mother on Instagram ... let her see the hoe she raised', {'entities': [(50, 59, 'Entertainment')]}), ('RT @SmittySav: Nigga you ever went and tried to buy a nice RUG?! https://t.co/3FdKt5CLAB', {'entities': [(59, 62, 'Product'), (48, 51, 'shopping')]}), ('RT @yobanimarquezz: I’m telling FAFSA y’all got the iphone 11 and a rose gold mac book', {'entities': [(32, 37, 'Money')]}), ('RT @BenSPLATT: thank you all for streaming the sh*t out of the @the_politician soundtrack- here’s a small token of gratitude from me &amp; my p…', {'entities': [(33, 42, 'Entertainment'), (79, 89, 'Entertainment')]}), ('RT @peytnhaag: me: if u drink this coffee ur gonna get jittery and anxious and ur gonna feel sick later', {'entities': [(24, 29, 'Food'), (35, 41, 'Food')]}), ('juice', {'entities': [(0, 5, 'Food')]}), ('RT @hstyleswomen: Polaroid harry styles is the definition of 90s dreamboy https://t.co/8p5NnHmWvU', {'entities': [(65, 73, 'Love')]}), ('RT @Brittany_broski: today’s generation just doesn’t get it man. no ones ever had to balance raising tamagotchis, Nintendogs, webkinz, AND…', {'entities': [(101, 112, 'Entertainment'), (114, 124, 'Entertainment'), (126, 133, 'Entertainment')]}), ("RT @getlaidan: idk how to explain it but u know the kind of episodes that had this transition between scenes that's exactly how I'm feeling…", {'entities': [(60, 68, 'Entertainment'), (102, 108, 'Entertainment')]}), ('RT @starksyndrome: robert downey jr is literally a trained dancer and yet this is the only move he does https://t.co/JstfPq0VzF', {'entities': [(59, 65, 'Entertainment')]}), ('RT @melissa_diaaz: You guys feel that breeze??? SANTA CLAUS IS COMING', {'entities': [(48, 59, 'Entertainment')]}), ('RT @38Godfrey: Finally the elusive Handmaid’s Tale / Georgia Southern Football / Star Wars cartoon bundle my family has been demanding http…', {'entities': [(35, 50, 'Entertainment'), (70, 78, 'Entertainment'), (81, 90, 'Entertainment'), (91, 98, 'Entertainment')]}), ('Is it just me or was this not a touchdown? https://t.co/oUqUez480E', {'entities': [(32, 41, 'Entertainment')]}), ('RT @savvv_a: me at chic fil a knowing damn well imma get that spicy deluxe meal everytime https://t.co/fvrO9hlvzG', {'entities': [(19, 27, 'Food')]}), ("what's ur concert history? ", {'entities': [(10, 17, 'Entertainment')]}), ('first concert: Raven Symoné', {'entities': [(15, 27, 'Entertainment')]}), ('last concert: Jonas Brothers Happiness Begins Tour', {'entities': [(14, 28, 'Entertainment'), (46, 50, 'Entertainment')]}), ('bullying', {'entities': [(0, 8, 'Justice')]}), ('RT @SAlabamabelles: RT if you know the difference http://t.co/yRNd8TRQKC', {'entities': [(0, 2, 'Help')]}), ('here’s my venmo if you’re feeling generous @ teresapink1 :))) #brokecollegestudent', {'entities': [(10, 15, 'Money')]}), ('RT @AndrewYang: I’m literally trying to give everybody money.', {'entities': [(55, 60, 'Money')]}), ('RT @SFLAaction: Abortion always ends an innocent human life.', {'entities': [(16, 24, 'Justice'), (40, 48, 'Justice')]}), ('RT @LilaGraceRose: Congress just passed a law to make cruelty to animals: ', {'entities': [(19, 27, 'Justice')]}), ('Shop my closet on @poshmarkapp! My username is teresapink1. Join with code TERESAPINK1 for a $10 credit! https://t.co/SHwrfJlXJR', {'entities': [(0, 4, 'shopping'), (8, 14, 'Clothing'), (93, 94, 'Money')]})]


def train_spacy(data,iterations):
    TRAIN_DATA = data
    nlp = spacy.blank('en')  # create blank Language class
    # create the built-in pipeline components and add them to the pipeline
    # nlp.create_pipe works for built-ins that are registered with spaCy
    if 'ner' not in nlp.pipe_names:
        ner = nlp.create_pipe('ner')
        nlp.add_pipe(ner, last=True)
       

    # add labels
    for _, annotations in TRAIN_DATA:
         for ent in annotations.get('entities'):
            ner.add_label(ent[2])

    # get names of other pipes to disable them during training
    other_pipes = [pipe for pipe in nlp.pipe_names if pipe != 'ner']
    with nlp.disable_pipes(*other_pipes):  # only train NER
        optimizer = nlp.begin_training()
        for itn in range(iterations):
            print("Statring iteration " + str(itn))
            random.shuffle(TRAIN_DATA)
            losses = {}
            for text, annotations in TRAIN_DATA:
                nlp.update(
                    [text],  # batch of texts
                    [annotations],  # batch of annotations
                    drop=0.2,  # dropout - make it harder to memorise data
                    sgd=optimizer,  # callable to update weights
                    losses=losses)
            print(losses)
    return nlp


prdnlp = train_spacy(TRAIN_DATA, 20)

# Save our trained Model
modelfile = input("Enter your Model Name: ")
prdnlp.to_disk(modelfile)

#Test your text
test_text = input("Enter your testing text: ")
doc = prdnlp(test_text)
for ent in doc.ents:
    print(ent.text, ent.start_char, ent.end_char, ent.label_)